<!doctype html>
<!-- Auteur : David Roche @davR74130 -->
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<title>Créer un jeu ou une simulation 3D</title>
		<link rel="stylesheet" href="css/css/vendor/bootstrap.min.css">
		<link rel="stylesheet" href="css/css/flat-ui.min.css">
		<link rel="stylesheet" href="highlight/styles/tomorrow-night.css">
		<link rel="stylesheet" href="css/style.css">
		<script src="highlight/highlight.pack.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
    <script src="./css/js/vendor/jquery.min.js"></script>
    <script src="./css/js/flat-ui.min.js"></script>
		<script>
			  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

			  ga('create', 'UA-92673245-1', 'auto');
			  ga('send', 'pageview');
			</script>
	</head>
	<body>
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <span class="navbar-brand">Créer un jeu ou une simulation 3D</span>
					<span class="navbar-brand">Activité 2</span>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Activités <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
	              <li><a href="./bab_intro.html">Introduction</a></li>
								<li><a href="./bab_a1.html">Activité 2</a></li>
	              <li><a href="./bab_a3.html">Activité 3</a></li>
	              <li><a href="./bab_a4.html">Activité 4</a></li>
								<li><a href="./bab_a5.html">Activité 5</a></li>
	              <li><a href="./bab_a6.html">Activité 6</a></li>
	              <li><a href="./bab_a7.html">Activité 7</a></li>
								<li><a href="./bab_a8.html">Activité 8</a></li>
	              <li><a href="./bab_a9.html">Activité 9</a></li>
								<li><a href="./bab_a10.html">Activité 10</a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="bab_a1.html"><span class="fui-triangle-left-large"></a></li>
						<li><a href="bab_a3.html"><span class="fui-triangle-right-large"></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <div class="container act">
			<p>
				Nous allons dans cette activité créer notre première scène.
			</p>
			<h4>À faire vous même 2.1</h4>
			<p>
				Créez (en faisant un copier-coller du dossier "app_00") un nouveau dossier "app_01", ouvrez, à l'aide d'un éditeur de texte le fichier script.js et saisissez le code ci-dessous dans ce fichier.
			</p>
			<p>
				script.js
			</p>
			<pre><code class="javascript">
var canvas = document.getElementById("renderCanvas");
var engine = new BABYLON.Engine(canvas, true);
var scene = new BABYLON.Scene(engine);
engine.runRenderLoop(function () {
 scene.render();
});
			</code></pre>
			<p>Tester "app_01" en double-cliquant sur le fichier "index.html". Il ne se passe rien, cela est normal, nous avons créé une scène, mais pour l'instant, elle est vide.</p>
			<hr>
			<p>
				Décortiquons ce code ligne par ligne :
			</p>
			<p>
				ligne 1
			</p>
			<p>
				Nous commençons par créer un objet "canvas" (utilisation de la méthode  getElementById et utilisation de l'id de la balise &ltcanvas&gt définie dans le fichier HTML)
			</p>
			<p>
				ligne 2
			</p>
			<p>Cet objet canvas est utilisé afin de créer l'objet nommé "engine".</p>
			<p>Arrêtons-nous quelques instants sur la structure de cette ligne 2 : le mot clé "new" permet de créer un nouvel objet (son utilisation n'est pas systématique, il existe d'autres façons pour créer un objet en JavaScript).
				"BABYLON.Engine" : "Engine" est une méthode de l'objet "BABYLON",  la structure du type "BABYLON.xxxxxx" signifie que nous utilisons une méthode ou un attribut propre à la bibliothèque Babylon.js. </p>
			<p>
				ligne 3
			</p>
			<p>Nous créons ensuite l'objet "scene" qui accueillera les différents "acteurs" (caméra, lumière, objet) de notre scène 3D .</p>
			<p>N.B. la structure sera toujours la même : création objet "canvas" -> création objet "engine" -> création objet "scene" -> utilisation de l'objet "scene"</p>
			<p>
				lignes 4,5 et 6
			</p>
			<p>
				Quand vous jouez à un jeu sur votre ordinateur (et que votre ordinateur manque de "puissance"), il arrive parfois que l'affichage saccade (on parle de "lag"), pourquoi ?
			</p>
			<p>
				Il faut savoir que "l'ordinateur" doit, plusieurs dizaines de fois par seconde (le nombre d'images affichées par seconde est souvent désigné par l'acronyme FPS (Frames per second)), afficher une nouvelle image à l'écran.
			</p>
			<p>
				Cela demande beaucoup de calculs (complexes) au microprocesseur central (CPU).
			</p>
			<p>
				Petite parenthèse : c'est d'ailleurs pour cela qu'aujourd'hui cette tâche est très souvent laissée à un microprocesseur spécialisé dans ce genre de calcul : le GPU (Graphics Processing Unit, ce microprocesseur spécialisé se trouve sur la carte graphique de votre ordinateur). Quand ni le CPU, ni le GPU n'arrivent à afficher suffisamment d'images par seconde, votre jeu saccade.
			</p>
			<p>
				En matière de programmation, il faut, une fois que la nouvelle image est prête à être à afficher (après par exemple avoir bougé de quelques pixels le personnage principal), envoyer l'ordre au CPU d'afficher cette nouvelle image (après avoir fait tous les calculs nécessaires).
			</p>
			<p>
				Dans BabylonJS, cet "ordre" est envoyé grâce à la ligne
			</p>
			<pre><code class="javascript">
scene.render();
			</code></pre>
			<p>
				Mais, vu que cet appel doit être effectué plusieurs fois par seconde (à chaque rendu d'image), il doit donc se trouver dans une boucle. Cette boucle est souvent appelée "boucle de jeu".
			</p>
			<p>La méthode "runRenderLoop" de l'objet "engine" va permettre d'exécuter plusieurs fois par seconde la fonction qui lui a été passée en paramètre (function () {scene.render();}). Comme vous pouvez le constater, cette fonction ne porte pas de nom, on parle de fonction anonyme. Les fonctions anonymes sont monnaie courante en JavaScript, elles sont très souvent utilisées comme paramètre d'autres fonctions (ou méthodes).</p>
			<p>Que fait cette fonction anonyme  ?</p>
			<p>Pas grand-chose, elle appelle la méthode "render".</p>
			<p>En résumé, la méthode "runRenderLoop" va permettre d'exécuter plusieurs fois par seconde la méthode "render" (et donc d'afficher une nouvelle image).</p>
			<p>Nous ne rentrerons pas dans les détails du fonctionnement de la méthode "runRenderLoop", mais sachez que cette méthode est "intelligente" et qu'elle permet donc d'obtenir les meilleurs résultats possible au niveau du FPS.</p>
    </div>
	</body>
</html>
